[{"user": {"following_url": "https://api.github.com/users/petrutlucian94/following{/other_user}", "url": "https://api.github.com/users/petrutlucian94", "site_admin": false, "gists_url": "https://api.github.com/users/petrutlucian94/gists{/gist_id}", "node_id": "MDQ6VXNlcjQ1NzA3NDk=", "starred_url": "https://api.github.com/users/petrutlucian94/starred{/owner}{/repo}", "gravatar_id": "", "id": 4570749, "events_url": "https://api.github.com/users/petrutlucian94/events{/privacy}", "avatar_url": "https://avatars1.githubusercontent.com/u/4570749?v=4", "login": "petrutlucian94", "repos_url": "https://api.github.com/users/petrutlucian94/repos", "subscriptions_url": "https://api.github.com/users/petrutlucian94/subscriptions", "followers_url": "https://api.github.com/users/petrutlucian94/followers", "html_url": "https://github.com/petrutlucian94", "received_events_url": "https://api.github.com/users/petrutlucian94/received_events", "type": "User", "organizations_url": "https://api.github.com/users/petrutlucian94/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "Having a centralized place for those pipeline definitions sounds great, we avoid duplication and simplify CI management.\r\n\r\nI guess that in the future, the test scenarios may become more complex, so this repo may hold other files as well (e.g. other job definition files, scripts, simple tools, etc).", "updated_at": "2019-05-09T08:01:24Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/490795837", "author_association": "NONE", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-490795837", "created_at": "2019-05-09T08:01:24Z", "id": 490795837, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MDc5NTgzNw=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "Renamed the proposed named to rust-vmm-ci as I was thinking to use it for other common tests as well. For example we can have [test_coverage.py](https://github.com/rust-vmm/kvm-ioctls/blob/master/tests/test_coverage.py) there so other projects can reuse it.", "updated_at": "2019-05-09T09:20:57Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/490827229", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-490827229", "created_at": "2019-05-09T09:20:57Z", "id": 490827229, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MDgyNzIyOQ=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "Additional proposal: we can have one pipeline for each platform and operating system we want to support. And let me tell you why:\r\n1. Some crates (like vm-memory) will also have support for Windows so you want to the integration tests to pass on windows as well. But you can't have it in the default pipeline because some crates cannot have it (like kvm-ioctls).\r\n2. Ideally we would have *most* of the crates work on arm and x86. That means that in our pipelines we would have same tests on x86 and arm as well. But some tools are not available on arm, so the steps are not exactly the same. Examples of things that aren't available (yet) on arm are clippy and kcov. Now, when we start development we might not want to add support from both arm and x86 from the first PR because it might turn out to be very complex and hard to review. So we can start with x86 and only use the x86 pipeline till support for arm is added.\r\n\r\nWith our current configuration of crates, platforms and operating systems we would end up having 3 pipelines:\r\n- x86_linux_pipeline.yml (used by kvm-ioctls, vm-memory, vmm-sys-utils)\r\n- x86_windows_pipeline.yml (used by vm-memory)\r\n- arm_linux_pipeline.yml (used by kvm-ioctls, vmm-sys-utils)", "updated_at": "2019-05-09T09:22:15Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/490827640", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-490827640", "created_at": "2019-05-09T09:22:15Z", "id": 490827640, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MDgyNzY0MA=="}, {"user": {"following_url": "https://api.github.com/users/rbradford/following{/other_user}", "url": "https://api.github.com/users/rbradford", "site_admin": false, "gists_url": "https://api.github.com/users/rbradford/gists{/gist_id}", "node_id": "MDQ6VXNlcjU4ODIyNA==", "starred_url": "https://api.github.com/users/rbradford/starred{/owner}{/repo}", "gravatar_id": "", "id": 588224, "events_url": "https://api.github.com/users/rbradford/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/588224?v=4", "login": "rbradford", "repos_url": "https://api.github.com/users/rbradford/repos", "subscriptions_url": "https://api.github.com/users/rbradford/subscriptions", "followers_url": "https://api.github.com/users/rbradford/followers", "html_url": "https://github.com/rbradford", "received_events_url": "https://api.github.com/users/rbradford/received_events", "type": "User", "organizations_url": "https://api.github.com/users/rbradford/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "Some repos might need different pipelines, perhaps to prepare something: https://github.com/rust-vmm/linux-loader/pull/2#discussion_r282446524\r\n\r\nFor this specific example it might make sense to just have a ci-prepare.sh in that repository and then have the common script `[test -a ci-prepare.sh] && ci-prepare.sh`", "updated_at": "2019-05-09T11:51:25Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/490871508", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-490871508", "created_at": "2019-05-09T11:51:25Z", "id": 490871508, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MDg3MTUwOA=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@rbradford you can have custom hooks executed before running a command or before checking out the repository code. I think the prepare.sh script should be called in the hook and not part of the pipeline step so that the steps can be independent of the repository being tested. What do you say?\r\n\r\nIf you want to learn more about hooks you can check the [Buildkite hooks documentation](https://buildkite.com/docs/agent/v3/hooks).", "updated_at": "2019-05-10T10:46:14Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491245930", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491245930", "created_at": "2019-05-10T10:46:14Z", "id": 491245930, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTI0NTkzMA=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "This is a summary of the discussion points from the email thread.\r\n@sboeuf @petrutlucian94 please correct me if there is anything I misunderstood.\r\n\r\n### Sharing the CI pipelines or other related tools\r\nThere are currently two proposals:\r\n- use git submodules\r\n- script that pulls the latest CI. @sboeuf : \"You could have a dedicated \"ci\" directory (for every crate) in which you could have the same script that pulls the content of the \"ci\" repo before to call into one pipeline or another (that's the part specific to each crate).\"\r\n\r\n### Webhooks for the CI\r\nAlso two proposals:\r\n- one webhook per repository\r\n- one webhook/pipeline\r\n\r\n### Parallelizing the Jobs\r\n\r\n@petrutlucian94 \"each buildkite agent runs one step/job at a time, so I think we should run multiple agents per host (e.g. by passing \u201c\u2014spawn <agent_count>\u201d). One idea would be to just run one agent per host cpu core.\"", "updated_at": "2019-05-10T11:25:41Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491249240", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491249240", "created_at": "2019-05-10T11:00:01Z", "id": 491249240, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTI0OTI0MA=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": ">     * script that pulls the latest CI. @sboeuf : \"You could have a dedicated \"ci\" directory (for every crate) in which you could have the same script that pulls the content of the \"ci\" repo before to call into one pipeline or another (that's the part specific to each crate).\"\r\n\r\n@sboeuf I don't see a big advantage here with using this instead of regular git submodule. I like having a fixed version for the pipelines because this implies you are only updating to a new version of the CI intentionally. If you are in the middle of a release or in the middle of a bug fix you don't want the CI to break for something that is unrelated to what you are doing.\r\n\r\nI don't necessarily want to use submodules either, it just felt like the most natural way of consuming the CI.\r\n\r\n> ### Webhooks for the CI\r\n> \r\n> Also two proposals:\r\n> \r\n>     * one webhook per repository\r\n> \r\n>     * one webhook/pipeline\r\n\r\n@petrutlucian94 the steps can run in parallel without having multiple steps. So the only thing that would be serial here is the download of the pipelines which should be sub-second. For simplicity I would keep it as one webhook/repository until we have a good reason to complicate ourselves with multiple webhooks. From my understanding, having multiple webhooks also means having multiple Buildkite projects because one project supports only one webhook. By project I mean [`kvm-ioctl-ci`](https://buildkite.com/rust-vmm/kvm-ioctls-ci) which where we define the pipeline.\r\nAny other reason for having multiple webhooks other than speed of CI?\r\n\r\n> ### Parallelizing the Jobs\r\n> \r\n> @petrutlucian94 \"each buildkite agent runs one step/job at a time, so I think we should run multiple agents per host (e.g. by passing \u201c\u2014spawn <agent_count>\u201d). One idea would be to just run one agent per host cpu core.\"\r\n\r\nRight now the load is very low. Once we add more repositories and the load increases we can scale up the number of agents. I wouldn't necessarily have one/core because it's a waste of resources since they aren't actually going to do anything most of the time. Maybe we can use auto-scaling for this particular issue.\r\n", "updated_at": "2019-05-10T11:28:34Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491254078", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491254078", "created_at": "2019-05-10T11:19:38Z", "id": 491254078, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTI1NDA3OA=="}, {"user": {"following_url": "https://api.github.com/users/petrutlucian94/following{/other_user}", "url": "https://api.github.com/users/petrutlucian94", "site_admin": false, "gists_url": "https://api.github.com/users/petrutlucian94/gists{/gist_id}", "node_id": "MDQ6VXNlcjQ1NzA3NDk=", "starred_url": "https://api.github.com/users/petrutlucian94/starred{/owner}{/repo}", "gravatar_id": "", "id": 4570749, "events_url": "https://api.github.com/users/petrutlucian94/events{/privacy}", "avatar_url": "https://avatars1.githubusercontent.com/u/4570749?v=4", "login": "petrutlucian94", "repos_url": "https://api.github.com/users/petrutlucian94/repos", "subscriptions_url": "https://api.github.com/users/petrutlucian94/subscriptions", "followers_url": "https://api.github.com/users/petrutlucian94/followers", "html_url": "https://github.com/petrutlucian94", "received_events_url": "https://api.github.com/users/petrutlucian94/received_events", "type": "User", "organizations_url": "https://api.github.com/users/petrutlucian94/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "> By project I mean kvm-ioctl-ci which where we define the pipeline.\r\n\r\nProbably we got the terms mixed up. So kvm-ioctl-ci itself is a buildkite pipeline, by splitting it into multiple pipelines I thought we'd end up with something like kvm-ioctl-ci.arm_linux, kvm-ioctl-ci.x86_linux, etc, each requiring its own webhook.\r\n\r\n> So the only thing that would be serial here is the download of the pipelines which should be sub-second.\r\n\r\nFrom what I can tell, those build steps wait for agents to become available. Each agent runs one step at a time and there's a single agent per platform defined at the moment. For example, as we can see here https://buildkite.com/rust-vmm/kvm-ioctls-ci/builds/198, \"check-warnings-arm\" ran in 20s and waited 1m 29s. It's really not that much, but if we get projects with time consuming tests (e.g. that may take more than 10-15 minutes) and multiple simultaneous builds (maybe for different crates), this becomes a bottlenck, while the CI host remains underutilized.\r\n\r\nI did a sandbox Windows CI for vm-memory and the test duration reduced from 6m31s to 2m18s after simply running more instances of the same agent on the same host (I have just a 6 core vm atm): https://buildkite.com/lpetrut/vm-memory-ci/builds/54 https://buildkite.com/lpetrut/vm-memory-ci/builds/53.\r\n\r\n> I wouldn't necessarily have one/core because it's a waste of resources since they aren't actually going to do anything most of the time.\r\n\r\nIf there are no pending tasks, those agents will do nothing (other than running a heartbeat), consuming a negligible amount of resources. Ofc one agent per core would be too much when having 32 logical cores though :). Anyway, that was just a suggestion.\r\n", "updated_at": "2019-05-10T16:07:40Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491270704", "author_association": "NONE", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491270704", "created_at": "2019-05-10T12:25:41Z", "id": 491270704, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTI3MDcwNA=="}, {"user": {"following_url": "https://api.github.com/users/rbradford/following{/other_user}", "url": "https://api.github.com/users/rbradford", "site_admin": false, "gists_url": "https://api.github.com/users/rbradford/gists{/gist_id}", "node_id": "MDQ6VXNlcjU4ODIyNA==", "starred_url": "https://api.github.com/users/rbradford/starred{/owner}{/repo}", "gravatar_id": "", "id": 588224, "events_url": "https://api.github.com/users/rbradford/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/588224?v=4", "login": "rbradford", "repos_url": "https://api.github.com/users/rbradford/repos", "subscriptions_url": "https://api.github.com/users/rbradford/subscriptions", "followers_url": "https://api.github.com/users/rbradford/followers", "html_url": "https://github.com/rbradford", "received_events_url": "https://api.github.com/users/rbradford/received_events", "type": "User", "organizations_url": "https://api.github.com/users/rbradford/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "> @rbradford you can have custom hooks executed before running a command or before checking out the repository code. I think the prepare.sh script should be called in the hook and not part of the pipeline step so that the steps can be independent of the repository being tested. What do you say?\r\n\r\nAnd that's still going to work if everything is centralised into a common repo? If so, sounds good!", "updated_at": "2019-05-10T13:18:09Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491285508", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491285508", "created_at": "2019-05-10T13:18:09Z", "id": 491285508, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTI4NTUwOA=="}, {"user": {"following_url": "https://api.github.com/users/sboeuf/following{/other_user}", "url": "https://api.github.com/users/sboeuf", "site_admin": false, "gists_url": "https://api.github.com/users/sboeuf/gists{/gist_id}", "node_id": "MDQ6VXNlcjIyODkwNDEz", "starred_url": "https://api.github.com/users/sboeuf/starred{/owner}{/repo}", "gravatar_id": "", "id": 22890413, "events_url": "https://api.github.com/users/sboeuf/events{/privacy}", "avatar_url": "https://avatars3.githubusercontent.com/u/22890413?v=4", "login": "sboeuf", "repos_url": "https://api.github.com/users/sboeuf/repos", "subscriptions_url": "https://api.github.com/users/sboeuf/subscriptions", "followers_url": "https://api.github.com/users/sboeuf/followers", "html_url": "https://github.com/sboeuf", "received_events_url": "https://api.github.com/users/sboeuf/received_events", "type": "User", "organizations_url": "https://api.github.com/users/sboeuf/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@andreeaflorescu \r\n>I like having a fixed version for the pipelines because this implies you are only updating to a new version of the CI intentionally. If you are in the middle of a release or in the middle of a bug fix you don't want the CI to break for something that is unrelated to what you are doing.\r\n\r\nFair enough, let's use git submodules then!", "updated_at": "2019-05-10T15:16:48Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491325895", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491325895", "created_at": "2019-05-10T15:16:48Z", "id": 491325895, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTMyNTg5NQ=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@rbradford the hooks are on the machines where the builkite-agent is running. So yes. In the hook you have information about the repository being tested so you can have commands that are executed only for some of them.", "updated_at": "2019-05-10T16:08:44Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491343424", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491343424", "created_at": "2019-05-10T16:08:44Z", "id": 491343424, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTM0MzQyNA=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "> Probably we got the terms mixed up. So kvm-ioctl-ci itself is a buildkite pipeline, by splitting it into multiple pipelines I thought we'd end up with something like kvm-ioctl-ci.arm_linux, kvm-ioctl-ci.x86_linux, etc, each requiring its own webhook.\r\n\r\n@petrutlucian94 I am not sure if this is how it works and I will have to check. My proposal would be to have one pipeline/project with one associated webhook. This is what kvm-ioctls-ci is today. Then, in kvm-ioctls we would have 2 steps:\r\n- one for uploading x86_linux_pipeline.yaml\r\n- one for uploading arm_linux_pipeline.yaml\r\n\r\nThe two pipelines definitions would have the tests specific for each platform, but they will both be triggered by the same webhook. We can add multiple agents so the tests are run in parallel. Does that make sense?\r\n\r\n> \r\n> From what I can tell, those build steps wait for agents to become available. Each agent runs one step at a time and there's a single agent per platform defined at the moment. For example, as we can see here https://buildkite.com/rust-vmm/kvm-ioctls-ci/builds/198, \"check-warnings-arm\" ran in 20s and waited 1m 29s. It's really not that much, but if we get projects with time consuming tests (e.g. that may take more than 10-15 minutes) and multiple simultaneous builds (maybe for different crates), this becomes a bottlenck, while the CI host remains underutilized.\r\n\r\nYap, I agree. Once we have multiple repository and those repositories have multiple PRs and so we can add more agents.\r\n\r\n", "updated_at": "2019-05-10T16:16:51Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/491346046", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-491346046", "created_at": "2019-05-10T16:16:51Z", "id": 491346046, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTM0NjA0Ng=="}, {"user": {"following_url": "https://api.github.com/users/sameo/following{/other_user}", "url": "https://api.github.com/users/sameo", "site_admin": false, "gists_url": "https://api.github.com/users/sameo/gists{/gist_id}", "node_id": "MDQ6VXNlcjEwNDM4NjM=", "starred_url": "https://api.github.com/users/sameo/starred{/owner}{/repo}", "gravatar_id": "", "id": 1043863, "events_url": "https://api.github.com/users/sameo/events{/privacy}", "avatar_url": "https://avatars2.githubusercontent.com/u/1043863?v=4", "login": "sameo", "repos_url": "https://api.github.com/users/sameo/repos", "subscriptions_url": "https://api.github.com/users/sameo/subscriptions", "followers_url": "https://api.github.com/users/sameo/followers", "html_url": "https://github.com/sameo", "received_events_url": "https://api.github.com/users/sameo/received_events", "type": "User", "organizations_url": "https://api.github.com/users/sameo/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "> @rbradford the hooks are on the machines where the builkite-agent is running.\r\n\r\nAFAIU that's for the agent hooks. There are also repository scripts that live in the `.buildkite/hooks/`, I think this is what we'd want in that case. ", "updated_at": "2019-05-20T10:13:43Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/493924794", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-493924794", "created_at": "2019-05-20T10:13:43Z", "id": 493924794, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzkyNDc5NA=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@sameo yap, we can have per repository hooks. I missed that one!\r\n\r\nFor future reference: https://buildkite.com/docs/agent/v3/hooks#repository-hooks", "updated_at": "2019-05-20T10:44:00Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/493934160", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-493934160", "created_at": "2019-05-20T10:44:00Z", "id": 493934160, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MzkzNDE2MA=="}, {"user": {"following_url": "https://api.github.com/users/sameo/following{/other_user}", "url": "https://api.github.com/users/sameo", "site_admin": false, "gists_url": "https://api.github.com/users/sameo/gists{/gist_id}", "node_id": "MDQ6VXNlcjEwNDM4NjM=", "starred_url": "https://api.github.com/users/sameo/starred{/owner}{/repo}", "gravatar_id": "", "id": 1043863, "events_url": "https://api.github.com/users/sameo/events{/privacy}", "avatar_url": "https://avatars2.githubusercontent.com/u/1043863?v=4", "login": "sameo", "repos_url": "https://api.github.com/users/sameo/repos", "subscriptions_url": "https://api.github.com/users/sameo/subscriptions", "followers_url": "https://api.github.com/users/sameo/followers", "html_url": "https://github.com/sameo", "received_events_url": "https://api.github.com/users/sameo/received_events", "type": "User", "organizations_url": "https://api.github.com/users/sameo/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@andreeaflorescu Right, but how would we do that if each repo's `.buildkite` is a git submodule?", "updated_at": "2019-05-20T12:01:18Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/493957121", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-493957121", "created_at": "2019-05-20T12:01:18Z", "id": 493957121, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzk1NzEyMQ=="}, {"user": {"following_url": "https://api.github.com/users/sameo/following{/other_user}", "url": "https://api.github.com/users/sameo", "site_admin": false, "gists_url": "https://api.github.com/users/sameo/gists{/gist_id}", "node_id": "MDQ6VXNlcjEwNDM4NjM=", "starred_url": "https://api.github.com/users/sameo/starred{/owner}{/repo}", "gravatar_id": "", "id": 1043863, "events_url": "https://api.github.com/users/sameo/events{/privacy}", "avatar_url": "https://avatars2.githubusercontent.com/u/1043863?v=4", "login": "sameo", "repos_url": "https://api.github.com/users/sameo/repos", "subscriptions_url": "https://api.github.com/users/sameo/subscriptions", "followers_url": "https://api.github.com/users/sameo/followers", "html_url": "https://github.com/sameo", "received_events_url": "https://api.github.com/users/sameo/received_events", "type": "User", "organizations_url": "https://api.github.com/users/sameo/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@andreeaflorescu Let's go an create the repo anyway. We'll find the best way to use it across repos once it's there and filled.", "updated_at": "2019-05-20T12:10:05Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/493959770", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-493959770", "created_at": "2019-05-20T12:10:05Z", "id": 493959770, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzk1OTc3MA=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@sameo as discussed offline, I would have rust-vmm-ci as a git submodule in every repository. The `rust-vmm-ci` directory will have all the things that are shareable by all repository like a `common-pipeline.yml` and the coverage test. To run the common pipeline as part of the CI, you would need to add a step like:\r\n```buildkite-agent pipeline upload rust-vmm-ci/common-pipeline.yml```\r\n\r\nThen each repository will have a `.buildkite` folder which contains custom tests in `custom-pipeline.yml` and a `.buildkite/hooks/` which contains the custom per repository hooks. To run the custom pipeline, you need to add an additional step to buildkite CI:\r\n```buildkite-agent pipeline upload .buildkite/custom-pipeline.yml```\r\n\r\nIf the crate doesn't need something fancy for the hooks I think we can use the defaults which will be hosted on the machine that's running the agent. I would expect the default hooks to be overwritten by the ones in `.buildkite/hooks`. \r\n\r\nI haven't tried out any of these things though, I really hope this is how it works :))", "updated_at": "2019-05-20T12:22:31Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/493963735", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-493963735", "created_at": "2019-05-20T12:22:31Z", "id": 493963735, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Mzk2MzczNQ=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "Created the repo: https://github.com/rust-vmm/rust-vmm-ci", "updated_at": "2019-05-20T14:58:45Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/494023842", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-494023842", "created_at": "2019-05-20T14:58:45Z", "id": 494023842, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NDAyMzg0Mg=="}, {"user": {"following_url": "https://api.github.com/users/bonzini/following{/other_user}", "url": "https://api.github.com/users/bonzini", "site_admin": false, "gists_url": "https://api.github.com/users/bonzini/gists{/gist_id}", "node_id": "MDQ6VXNlcjQyMDgy", "starred_url": "https://api.github.com/users/bonzini/starred{/owner}{/repo}", "gravatar_id": "", "id": 42082, "events_url": "https://api.github.com/users/bonzini/events{/privacy}", "avatar_url": "https://avatars2.githubusercontent.com/u/42082?v=4", "login": "bonzini", "repos_url": "https://api.github.com/users/bonzini/repos", "subscriptions_url": "https://api.github.com/users/bonzini/subscriptions", "followers_url": "https://api.github.com/users/bonzini/followers", "html_url": "https://github.com/bonzini", "received_events_url": "https://api.github.com/users/bonzini/received_events", "type": "User", "organizations_url": "https://api.github.com/users/bonzini/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "@andreeaflorescu Close?", "updated_at": "2019-06-03T09:26:56Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/498182472", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-498182472", "created_at": "2019-06-03T09:26:56Z", "id": 498182472, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODE4MjQ3Mg=="}, {"user": {"following_url": "https://api.github.com/users/andreeaflorescu/following{/other_user}", "url": "https://api.github.com/users/andreeaflorescu", "site_admin": false, "gists_url": "https://api.github.com/users/andreeaflorescu/gists{/gist_id}", "node_id": "MDQ6VXNlcjI4MTU5NDQ=", "starred_url": "https://api.github.com/users/andreeaflorescu/starred{/owner}{/repo}", "gravatar_id": "", "id": 2815944, "events_url": "https://api.github.com/users/andreeaflorescu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/2815944?v=4", "login": "andreeaflorescu", "repos_url": "https://api.github.com/users/andreeaflorescu/repos", "subscriptions_url": "https://api.github.com/users/andreeaflorescu/subscriptions", "followers_url": "https://api.github.com/users/andreeaflorescu/followers", "html_url": "https://github.com/andreeaflorescu", "received_events_url": "https://api.github.com/users/andreeaflorescu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/andreeaflorescu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/community/issues/56", "body": "PR: https://github.com/rust-vmm/rust-vmm-ci/pull/2\r\n\r\n@bonzini let's close this after the PR is merged.", "updated_at": "2019-06-06T13:24:49Z", "url": "https://api.github.com/repos/rust-vmm/community/issues/comments/499492267", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/community/issues/56#issuecomment-499492267", "created_at": "2019-06-06T13:24:49Z", "id": 499492267, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTQ5MjI2Nw=="}]