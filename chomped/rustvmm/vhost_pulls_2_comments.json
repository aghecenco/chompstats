[{"user": {"following_url": "https://api.github.com/users/sboeuf/following{/other_user}", "url": "https://api.github.com/users/sboeuf", "site_admin": false, "gists_url": "https://api.github.com/users/sboeuf/gists{/gist_id}", "node_id": "MDQ6VXNlcjIyODkwNDEz", "starred_url": "https://api.github.com/users/sboeuf/starred{/owner}{/repo}", "gravatar_id": "", "id": 22890413, "events_url": "https://api.github.com/users/sboeuf/events{/privacy}", "avatar_url": "https://avatars3.githubusercontent.com/u/22890413?v=4", "login": "sboeuf", "repos_url": "https://api.github.com/users/sboeuf/repos", "subscriptions_url": "https://api.github.com/users/sboeuf/subscriptions", "followers_url": "https://api.github.com/users/sboeuf/followers", "html_url": "https://github.com/sboeuf", "received_events_url": "https://api.github.com/users/sboeuf/received_events", "type": "User", "organizations_url": "https://api.github.com/users/sboeuf/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "@jiangliu @bonzini @andreeaflorescu what's the status here?\r\nI'm very interested in seeing this crate moving forward in order to base some vhost-user implementations off of it.", "updated_at": "2019-05-22T22:49:29Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/495002923", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-495002923", "created_at": "2019-05-22T22:49:29Z", "id": 495002923, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTAwMjkyMw=="}, {"user": {"following_url": "https://api.github.com/users/jiangliu/following{/other_user}", "url": "https://api.github.com/users/jiangliu", "site_admin": false, "gists_url": "https://api.github.com/users/jiangliu/gists{/gist_id}", "node_id": "MDQ6VXNlcjE5MzE1MTY=", "starred_url": "https://api.github.com/users/jiangliu/starred{/owner}{/repo}", "gravatar_id": "", "id": 1931516, "events_url": "https://api.github.com/users/jiangliu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/1931516?v=4", "login": "jiangliu", "repos_url": "https://api.github.com/users/jiangliu/repos", "subscriptions_url": "https://api.github.com/users/jiangliu/subscriptions", "followers_url": "https://api.github.com/users/jiangliu/followers", "html_url": "https://github.com/jiangliu", "received_events_url": "https://api.github.com/users/jiangliu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/jiangliu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "> @jiangliu @bonzini @andreeaflorescu what's the status here?\r\n> I'm very interested in seeing this crate moving forward in order to base some vhost-user implementations off of it.\r\n\r\nI'm refine the crate to better support reconnection and almost ready, plan to send out early next week. I have also decoupled Unix domain socket client/server from host-user master/slave roles to enable the       use case that the vhost-user master acts as servers.  ", "updated_at": "2019-05-23T01:46:24Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/495036224", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-495036224", "created_at": "2019-05-23T01:46:24Z", "id": 495036224, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTAzNjIyNA=="}, {"user": {"following_url": "https://api.github.com/users/sboeuf/following{/other_user}", "url": "https://api.github.com/users/sboeuf", "site_admin": false, "gists_url": "https://api.github.com/users/sboeuf/gists{/gist_id}", "node_id": "MDQ6VXNlcjIyODkwNDEz", "starred_url": "https://api.github.com/users/sboeuf/starred{/owner}{/repo}", "gravatar_id": "", "id": 22890413, "events_url": "https://api.github.com/users/sboeuf/events{/privacy}", "avatar_url": "https://avatars3.githubusercontent.com/u/22890413?v=4", "login": "sboeuf", "repos_url": "https://api.github.com/users/sboeuf/repos", "subscriptions_url": "https://api.github.com/users/sboeuf/subscriptions", "followers_url": "https://api.github.com/users/sboeuf/followers", "html_url": "https://github.com/sboeuf", "received_events_url": "https://api.github.com/users/sboeuf/received_events", "type": "User", "organizations_url": "https://api.github.com/users/sboeuf/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "@jiangliu the PR LGTM! Are we waiting for review from some folks or do you still have some work planned on this PR?\r\n/cc @andreeaflorescu @bonzini @sameo ", "updated_at": "2019-06-03T22:35:49Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/498451567", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-498451567", "created_at": "2019-06-03T22:35:49Z", "id": 498451567, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODQ1MTU2Nw=="}, {"user": {"following_url": "https://api.github.com/users/jiangliu/following{/other_user}", "url": "https://api.github.com/users/jiangliu", "site_admin": false, "gists_url": "https://api.github.com/users/jiangliu/gists{/gist_id}", "node_id": "MDQ6VXNlcjE5MzE1MTY=", "starred_url": "https://api.github.com/users/jiangliu/starred{/owner}{/repo}", "gravatar_id": "", "id": 1931516, "events_url": "https://api.github.com/users/jiangliu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/1931516?v=4", "login": "jiangliu", "repos_url": "https://api.github.com/users/jiangliu/repos", "subscriptions_url": "https://api.github.com/users/jiangliu/subscriptions", "followers_url": "https://api.github.com/users/jiangliu/followers", "html_url": "https://github.com/jiangliu", "received_events_url": "https://api.github.com/users/jiangliu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/jiangliu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "> @jiangliu the PR LGTM! Are we waiting for review from some folks or do you still have some work planned on this PR?\r\n> /cc @andreeaflorescu @bonzini @sameo\r\nCurrently waiting reviews, and then need to refine documentation and other requirements of the rust-vmm project.\r\n", "updated_at": "2019-06-04T03:05:01Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/498501233", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-498501233", "created_at": "2019-06-04T03:03:49Z", "id": 498501233, "node_id": "MDEyOklzc3VlQ29tbWVudDQ5ODUwMTIzMw=="}, {"user": {"following_url": "https://api.github.com/users/stefanha/following{/other_user}", "url": "https://api.github.com/users/stefanha", "site_admin": false, "gists_url": "https://api.github.com/users/stefanha/gists{/gist_id}", "node_id": "MDQ6VXNlcjM4ODkw", "starred_url": "https://api.github.com/users/stefanha/starred{/owner}{/repo}", "gravatar_id": "", "id": 38890, "events_url": "https://api.github.com/users/stefanha/events{/privacy}", "avatar_url": "https://avatars1.githubusercontent.com/u/38890?v=4", "login": "stefanha", "repos_url": "https://api.github.com/users/stefanha/repos", "subscriptions_url": "https://api.github.com/users/stefanha/subscriptions", "followers_url": "https://api.github.com/users/stefanha/followers", "html_url": "https://github.com/stefanha", "received_events_url": "https://api.github.com/users/stefanha/received_events", "type": "User", "organizations_url": "https://api.github.com/users/stefanha/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "> @sboeuf @jiangliu It seems that the item max_queue_num in node should not be configured by VMM. max_queue_num is obtained from slave by calling get_queue_num, to indicate the maximum queue number slave could support. It could be a gatekeeper to check if VMM setup the queues more than slave cloud handle. I see the set_vring_* functions is handling like this. Thus, I thought the support added here should be removed. Correct me if I'm wrong :-P\r\n\r\nThis appears to be wrong.  Here is what I've found:\r\n\r\nIn vhost-user \"multiple virtqueues\" and \"multiqueue\" are two separate concepts.  Devices with multiple virtqueues have always been possible.  From the beginning of vhost the vhost-net device had an rx virtqueue and a tx virtqueue.  There was just no way for the master to ask the slave if more virtqueues are supported.\r\n\r\nDevices with fixed virtqueue layouts are NOT required to advertise VHOST_USER_PROTOCOL_F_MQ because the VMM already knows the number of virtqueues.\r\n\r\nWhen multiqueue devices were implemented it was necessary to extend the protocol so that the slave could report how many virtqueues are available.  Multiqueue devices have a variable number of virtqueues that depends on the capabilities of the device (i.e. the vhost-user slave).\r\n\r\nI think that ideally all vhost-user device backends should implement VHOST_USER_PROTOCOL_F_MQ and VHOST_USER_GET_QUEUE_NUM so the master can fetch max_queue_num from the vhost device backend.\r\n\r\nHowever, according to the vhost-user specification and how existing devices are implemented, it is not possible to rely on this today.  Here is how it works:\r\n\r\n1. The VMM configures max_queue_num based on the number of queues offered by its virtio device (NOT the vhost device).\r\n2. If the vhost-user device backend supports VHOST_USER_GET_QUEUE_NUM then max_queue_num can be fetched and updates its value.\r\n3. If the VMM user explicitly requested a specific multiqueue number (e.g. on the command-line or through a management API) then device creation fails if this number exceeds max_queue_num (e.g. \"Cannot create virtio-net device with 1024 virtqueues, vhost-user slave only supports 64\").\r\n\r\nTherefore Sebastien's patch or something similar is necessary.  The current master code conflates multiqueue with multiple virtqueues when they are actually separate concepts.\r\n\r\nI have sent QEMU patches to make libvhost-user always advertise VHOST_USER_PROTOCOL_F_MQ but please do not rely on this.", "updated_at": "2019-06-21T18:37:20Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/504529332", "author_association": "NONE", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-504529332", "created_at": "2019-06-21T18:37:20Z", "id": 504529332, "node_id": "MDEyOklzc3VlQ29tbWVudDUwNDUyOTMzMg=="}, {"user": {"following_url": "https://api.github.com/users/bjzhjing/following{/other_user}", "url": "https://api.github.com/users/bjzhjing", "site_admin": false, "gists_url": "https://api.github.com/users/bjzhjing/gists{/gist_id}", "node_id": "MDQ6VXNlcjQ2NjYxODA2", "starred_url": "https://api.github.com/users/bjzhjing/starred{/owner}{/repo}", "gravatar_id": "", "id": 46661806, "events_url": "https://api.github.com/users/bjzhjing/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/46661806?v=4", "login": "bjzhjing", "repos_url": "https://api.github.com/users/bjzhjing/repos", "subscriptions_url": "https://api.github.com/users/bjzhjing/subscriptions", "followers_url": "https://api.github.com/users/bjzhjing/followers", "html_url": "https://github.com/bjzhjing", "received_events_url": "https://api.github.com/users/bjzhjing/received_events", "type": "User", "organizations_url": "https://api.github.com/users/bjzhjing/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "@stefanha There is one thing I would to confirm with you, that max_queue_num represents the queue pair number, rather than the total number of virtqueues, right?", "updated_at": "2019-07-18T02:51:42Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/512644172", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-512644172", "created_at": "2019-07-18T02:51:42Z", "id": 512644172, "node_id": "MDEyOklzc3VlQ29tbWVudDUxMjY0NDE3Mg=="}, {"user": {"following_url": "https://api.github.com/users/stefanha/following{/other_user}", "url": "https://api.github.com/users/stefanha", "site_admin": false, "gists_url": "https://api.github.com/users/stefanha/gists{/gist_id}", "node_id": "MDQ6VXNlcjM4ODkw", "starred_url": "https://api.github.com/users/stefanha/starred{/owner}{/repo}", "gravatar_id": "", "id": 38890, "events_url": "https://api.github.com/users/stefanha/events{/privacy}", "avatar_url": "https://avatars1.githubusercontent.com/u/38890?v=4", "login": "stefanha", "repos_url": "https://api.github.com/users/stefanha/repos", "subscriptions_url": "https://api.github.com/users/stefanha/subscriptions", "followers_url": "https://api.github.com/users/stefanha/followers", "html_url": "https://github.com/stefanha", "received_events_url": "https://api.github.com/users/stefanha/received_events", "type": "User", "organizations_url": "https://api.github.com/users/stefanha/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "> @stefanha There is one thing I would to confirm with you, that max_queue_num represents the queue pair number, rather than the total number of virtqueues, right?\r\n\r\nmax_queue_num is the number of virtqueues.", "updated_at": "2019-07-18T07:50:00Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/512705905", "author_association": "NONE", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-512705905", "created_at": "2019-07-18T07:50:00Z", "id": 512705905, "node_id": "MDEyOklzc3VlQ29tbWVudDUxMjcwNTkwNQ=="}, {"user": {"following_url": "https://api.github.com/users/jiangliu/following{/other_user}", "url": "https://api.github.com/users/jiangliu", "site_admin": false, "gists_url": "https://api.github.com/users/jiangliu/gists{/gist_id}", "node_id": "MDQ6VXNlcjE5MzE1MTY=", "starred_url": "https://api.github.com/users/jiangliu/starred{/owner}{/repo}", "gravatar_id": "", "id": 1931516, "events_url": "https://api.github.com/users/jiangliu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/1931516?v=4", "login": "jiangliu", "repos_url": "https://api.github.com/users/jiangliu/repos", "subscriptions_url": "https://api.github.com/users/jiangliu/subscriptions", "followers_url": "https://api.github.com/users/jiangliu/followers", "html_url": "https://github.com/jiangliu", "received_events_url": "https://api.github.com/users/jiangliu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/jiangliu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": "> Great, I'll let you know when this will be solved on the virtio-fs side of things.\r\n\r\nI plan to integrate this workaround into vhost with comments stating that it's a temporary workaround.", "updated_at": "2019-09-02T01:47:26Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/526974769", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-526974769", "created_at": "2019-09-02T01:47:26Z", "id": 526974769, "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjk3NDc2OQ=="}, {"user": {"following_url": "https://api.github.com/users/jiangliu/following{/other_user}", "url": "https://api.github.com/users/jiangliu", "site_admin": false, "gists_url": "https://api.github.com/users/jiangliu/gists{/gist_id}", "node_id": "MDQ6VXNlcjE5MzE1MTY=", "starred_url": "https://api.github.com/users/jiangliu/starred{/owner}{/repo}", "gravatar_id": "", "id": 1931516, "events_url": "https://api.github.com/users/jiangliu/events{/privacy}", "avatar_url": "https://avatars0.githubusercontent.com/u/1931516?v=4", "login": "jiangliu", "repos_url": "https://api.github.com/users/jiangliu/repos", "subscriptions_url": "https://api.github.com/users/jiangliu/subscriptions", "followers_url": "https://api.github.com/users/jiangliu/followers", "html_url": "https://github.com/jiangliu", "received_events_url": "https://api.github.com/users/jiangliu/received_events", "type": "User", "organizations_url": "https://api.github.com/users/jiangliu/orgs"}, "issue_url": "https://api.github.com/repos/rust-vmm/vhost/issues/2", "body": ">In vhost-user \"multiple virtqueues\" and \"multiqueue\" are two separate concepts. Devices with multiple >virtqueues have always been possible. From the beginning of vhost the vhost-net device had an rx >virtqueue and a tx virtqueue. There was just no way for the master to ask the slave if more virtqueues are >supported.\r\nThanks for the explanation, it's easy to mix up these two concepts.\r\nI will carry the patch from @sboeuf in next PR.\r\n", "updated_at": "2019-09-02T06:02:43Z", "url": "https://api.github.com/repos/rust-vmm/vhost/issues/comments/527013473", "author_association": "MEMBER", "html_url": "https://github.com/rust-vmm/vhost/pull/2#issuecomment-527013473", "created_at": "2019-09-02T06:02:43Z", "id": 527013473, "node_id": "MDEyOklzc3VlQ29tbWVudDUyNzAxMzQ3Mw=="}]